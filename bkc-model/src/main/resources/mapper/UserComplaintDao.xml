<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.bitflash.dao.UserComplaintDao">

    <select id="selectAppealList" resultType="cn.bitflash.bean.UserBuyBean">
        SELECT
            ui.nickname as nickname,
            uh.price as userPrice,
            uh.quantity as userQuantity,
            uc.order_state as orderState,
            uc.complaint_state as complaintState,
            uc.create_time as createTime,
            uc.order_id as orderId
        FROM
            user_complaint uc
        LEFT JOIN user_market_buy ub ON uc.order_id = ub.id
        LEFT JOIN user_info ui ON uc.complaint_uid = ui.uid
        WHERE
            ub.purchase_uid = #{uid}
            OR ub.sell_uid = #{uid}
        UNION
        SELECT
            ui.nickname as nickname,
            uth.price as userPrice,
            uth.purchase_quantity as userQuantity,
            uc.order_state as orderState,
            uc.complaint_state as complaintState,
            uc.create_time as createTime,
            uc.order_id as orderId
        FROM
            user_complaint uc
        LEFT JOIN user_market_trade uth ON uc.order_id = ut.id
        LEFT JOIN user_info ui ON uc.complaint_uid = ui.uid
        WHERE
            ut.purchase_uid = #{uid}
            OR ut.sell_uid = #{uid}
        limit #{pages},6
    </select>

    <select id="selectAppealCount" resultType="java.lang.Integer">
        SELECT
            count(0)
        FROM
            user_complaint uc
        WHERE
            uc.complaint_uid = #{uid}
            OR uc.contacts_uid = #{uid}
    </select>

    <select id="getComplaintMessage" resultType="cn.bitflash.bean.UserComplaintBean">
	SELECT
	ucc.*, (
		SELECT
			ui.nickname
		FROM
			user_info ui
		WHERE
			ui.uid = ucc.contacts_uid
	) AS contactsUname,
	(
		SELECT
			ui.mobile
		FROM
			user_info ui
		WHERE
			ui.uid = ucc.contacts_uid
	) AS contactsMobile,
(
		SELECT
			ui.nickname
		FROM
			user_info ui
		WHERE
			ui.uid = ucc.complaint_uid
	) AS complaintUname,
	(
		SELECT
			ui.mobile
		FROM
			user_info ui
		WHERE
			ui.uid = ucc.complaint_uid
	) AS complaintMobile
	FROM
		user_complaint ucc
	WHERE
		ucc.order_id = #{id}
    </select>


</mapper>